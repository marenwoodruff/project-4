<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>

<h1>Listing coffeeshops</h1>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Display address</th>
      <th>Display city</th>
      <th>Display state</th>
      <th>Display zip</th>
      <th>Neighborhood</th>
      <th>Phone</th>
      <th>Fair trade</th>
      <th>Organic</th>
      <th>Direct trade</th>
      <th>Yelp rating</th>
      <th>Yelp review</th>
      <th>Yelp</th>
      <th>Yelp url</th>
      <th>Url</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>

  <tbody>
    <% @coffeeshops.each do |coffeeshop| %>
      <tr>
        <td><%= coffeeshop.name %></td>
        <td><%= coffeeshop.display_address %></td>
        <td><%= coffeeshop.display_city %></td>
        <td><%= coffeeshop.display_state %></td>
        <td><%= coffeeshop.display_zip %></td>
        <td><%= coffeeshop.neighborhood %></td>
        <td><%= coffeeshop.phone %></td>
        <td><%= coffeeshop.fair_trade %></td>
        <td><%= coffeeshop.organic %></td>
        <td><%= coffeeshop.direct_trade %></td>
        <td><%= coffeeshop.yelp_rating %></td>
        <td><%= coffeeshop.yelp_review %></td>
        <td><%= coffeeshop.yelp_id %></td>
        <td><%= coffeeshop.yelp_url %></td>
        <td><%= coffeeshop.url %></td>
        <td><%= link_to 'Show', coffeeshop %></td>
        <td><%= link_to 'Edit', edit_coffeeshop_path(coffeeshop) %></td>
        <td><%= link_to 'Destroy', coffeeshop, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Coffeeshop', new_coffeeshop_path %>

<div>
  <h1>Our map goes here</h1>
  <%= form_tag coffeeshops_path, :method => :get do %>
    <p>
      <%= text_field_tag :search, params[:search] %>
      <%= submit_tag "Search Near", :name => nil %>
    </p>
  <% end %>
  <!-- <h1>Lat and Long</h1>
  <%#= form_tag coffeeshops_path, :method => :get do %>
    <p>
      <%#= text_field_tag :search_lat %>
      <%#= text_field_tag :search_lng %>
      <%#= submit_tag "Search Near", :name => nil %>
    </p>
  <%# end %> -->
    <!-- The "canvas," where our map is rendered -->
  <div id="map-canvas"></div>
</div>
<!-- Our gmaps4rails handler scripts -->
<script type="text/javascript">
handler = Gmaps.build('Google');
  // provider is where we pass in mapOptions like zoom, and our API key (not required)
  // internal is where we tell the map where to render and set options like   markers, bounds, etc.
  handler.buildMap({ provider: {zoom: 16, provider_key: "AIzaSyCYWhL3gSXTWROdo8CQMOiFyd6YNGzB918"}, internal: {id: 'map-canvas'}}, function(){
    <% @coffeeshops.each do |coffeeshop| %>
    markers = handler.addMarkers([
      {
        lat: <%=coffeeshop.latitude%>, // pulls in the latitude for the marker via ERB
        lng: <%=coffeeshop.longitude%>, // pulls in the longitude for the marker via ERB
        infowindow: "<%=coffeeshop.name%>" // info window text (this is optional)
      }
    ]);
    <% end %>
    handler.map.centerOn(markers[0]); // centers on the first marker in the array
  });


</script>

