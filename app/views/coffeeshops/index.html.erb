<%= render partial: 'layouts/navbar' %>
<%#= render partial: 'coffeeshop_list' %> 

<h1>Coffee Shops</h1>

<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>


<div>
  <p id="demo">Click the button to locate shops near you:
  <button class="button small" onclick="getLocation()">Locate Me</button>
  </p>
</div>
  <script>
    var x=document.getElementById("demo");
    function getLocation()
    {
      if (navigator.geolocation)
        {
        navigator.geolocation.getCurrentPosition(showPosition);
        }
      else{x.innerHTML="Geolocation is not supported by this browser.";}
    }
    function showPosition(position)
    {
      handler.map.centerOn(new google.maps.LatLng(position.coords.latitude, position.coords.longitude));
      search_lat = position.coords.latitude
      search_lng = position.coords.longitude
      // x.innerHTML="Latitude: " + search_lat +
      // "<br>Longitude: " + search_lng; 
      // @coffeeshop.distance_to(search_lat, search_lng)

    marker2 = handler.addMarkers([
      {
        lat: search_lat, // pulls in the latitude for the marker via ERB
        lng: search_lng, // pulls in the longitude for the marker via ERB
        picture: {
        url: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png",
        width:  36,
        height: 36
      },
        infowindow: 'You are here' // info window text (this is optional)
      }])
    }
</script>

<!-- <br /> -->




<div class="small-10 medium-6" id="map-div">
  
  <%= form_tag coffeeshops_path, :method => :get do %>
    <p>
      <%= text_field_tag :search, params[:search], :placeholder => "Enter your location" %>
      <%#= @city %>
      <%= submit_tag "Search Shops", :name => nil %>
    </p>
  <% end %>
    <!-- The "canvas," where our map is rendered -->
  <div class="small-6" id="map-canvas"></div>
  <h4>Nearby locations</h4>
 
</div>

<!-- Our gmaps4rails handler scripts -->
<script type="text/javascript">
  var handler = Gmaps.build('Google');
  // provider is where we pass in mapOptions like zoom, and our API key (not required)
  // internal is where we tell the map where to render and set options like   markers, bounds, etc.

  handler.buildMap({ provider: {zoom: 16, provider_key: "AIzaSyCYWhL3gSXTWROdo8CQMOiFyd6YNGzB918"}, internal: {id: 'map-canvas'}}, function(){
    // <% @coffeeshops.each do |coffeeshop| %>
    markers = handler.addMarkers([
      {
        lat: <%=coffeeshop.latitude%>, // pulls in the latitude for the marker via ERB
        lng: <%=coffeeshop.longitude%>, // pulls in the longitude for the marker via ERB
        infowindow: '<%= link_to "#{coffeeshop.name}", coffeeshop_path(coffeeshop) %>' // info window text (this is optional)
      }
    ]);
    // <% end %>
    handler.map.centerOn(markers[0]); // centers on the first marker in the array
  });

    

</script>

